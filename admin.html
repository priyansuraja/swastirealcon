<!DOCTYPE html>
<html lang="en">
<head>

<meta charset="UTF-8">
<title>Swasti Realcon CRM Dashboard</title>

<style>

body{
margin:0;
font-family:Segoe UI,Arial;
background:#f4f6f8;
}

/* Header */

.header{
background:#29323c;
color:white;
padding:15px 25px;
display:flex;
justify-content:space-between;
align-items:center;
}

.logout{
background:#ff4d4d;
border:none;
padding:8px 15px;
color:white;
cursor:pointer;
border-radius:5px;
}

/* Container */

.container{
padding:25px;
}

/* Stats */

.stats{
display:flex;
gap:20px;
margin-bottom:20px;
}

.card{
background:white;
padding:20px;
border-radius:8px;
box-shadow:0 5px 15px rgba(0,0,0,0.1);
flex:1;
}

.card h3{
margin:0;
color:#666;
}

.card h1{
margin:5px 0 0;
}

/* Search */

.search-bar{
margin-bottom:15px;
display:flex;
justify-content:space-between;
}

.search-bar input{
padding:8px;
width:250px;
}

.export{
background:#28a745;
color:white;
border:none;
padding:8px 15px;
cursor:pointer;
}

/* Table */

table{
width:100%;
border-collapse:collapse;
background:white;
box-shadow:0 5px 15px rgba(0,0,0,0.1);
}

th{
background:#29323c;
color:white;
padding:12px;
}

td{
padding:12px;
border-bottom:1px solid #eee;
}

tr:hover{
background:#f1f1f1;
}

.delete{
background:red;
color:white;
border:none;
padding:5px 10px;
cursor:pointer;
}

</style>

</head>

<body>

<div class="header">

<h2>Swasti Realcon CRM</h2>

<button class="logout" onclick="logout()">Logout</button>

</div>


<div class="container">


<div class="stats">

<div class="card">
<h3>Total Leads</h3>
<h1 id="total">0</h1>
</div>

<div class="card">
<h3>Today's Leads</h3>
<h1 id="today">0</h1>
</div>

</div>


<div class="search-bar">

<input
type="text"
id="search"
placeholder="Search by name..."
onkeyup="searchLeads()"
/>

<button class="export" onclick="exportExcel()">
Export Excel
</button>

</div>


<table>

<thead>

<tr>
<th>Name</th>
<th>Phone</th>
<th>City</th>
<th>Area</th>
<th>Price</th>
<th>Action</th>
</tr>

</thead>

<tbody id="table"></tbody>

</table>

</div>


<script>

let leadsData=[];


/* LOAD LEADS */

async function loadLeads(){

try{

const res=await fetch(
"http://localhost:5000/api/leads",
{
credentials:"include"
}
);

if(res.status===403){

alert("Login first");

location.href="login.html";

return;

}

leadsData=await res.json();

renderTable(leadsData);

updateStats();

}catch{

alert("Error loading");

}

}


/* RENDER TABLE */

function renderTable(data){

const table=document.getElementById("table");

table.innerHTML="";

data.forEach(lead=>{

table.innerHTML+=`

<tr>

<td>${lead.name}</td>

<td>${lead.phone}</td>

<td>${lead.city}</td>

<td>${lead.area}</td>

<td>${lead.price}</td>

<td>
<button
class="delete"
onclick="deleteLead(${lead.id})"
>
Delete
</button>
</td>

</tr>

`;

});

}


/* SEARCH */

function searchLeads(){

const value=
document.getElementById("search").value.toLowerCase();

const filtered=
leadsData.filter(
lead=>lead.name.toLowerCase().includes(value)
);

renderTable(filtered);

}


/* DELETE */

async function deleteLead(id){

if(!confirm("Delete this lead?")) return;

await fetch(
"http://localhost:5000/api/delete-lead/"+id,
{
method:"DELETE",
credentials:"include"
}
);

loadLeads();

}


/* EXPORT */

function exportExcel(){

let csv="Name,Phone,City,Area,Price\n";

leadsData.forEach(l=>{

csv+=`${l.name},${l.phone},${l.city},${l.area},${l.price}\n`;

});

const blob=new Blob([csv]);

const a=document.createElement("a");

a.href=URL.createObjectURL(blob);

a.download="leads.csv";

a.click();

}


/* STATS */

function updateStats(){

document.getElementById("total").innerText=
leadsData.length;

const today=new Date().toDateString();

let count=0;

leadsData.forEach(l=>{

const d=new Date(l.created_at).toDateString();

if(d===today) count++;

});

document.getElementById("today").innerText=count;

}


/* LOGOUT */

async function logout(){

await fetch(
"http://localhost:5000/logout",
{
method:"POST",
credentials:"include"
}
);

location.href="login.html";

}


loadLeads();

</script>

</body>
</html>
